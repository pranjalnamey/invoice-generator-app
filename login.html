<!-- login.html -->
<!DOCTYPE html>
<html>
<head><title>Activating Access...</title></head>
<body>
    <h1>Validating your access key, please wait...</h1>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const accessKey = params.get('key');

            if (!accessKey) {
                document.body.innerHTML = '<h1>Error: No access key provided. Please check your email.</h1>';
                return;
            }

            try {
                // Call your Azure Function
                const response = await fetch(`https://processrazorpaywebhook.azurewebsites.net/api/ValidateAccessKey?key=${accessKey}`);

                if (!response.ok) {
                     throw new Error('Invalid key.');
                }

                const result = await response.json();

                if (result.success) {
                    // The key is valid! Create a session token.
                    const sessionToken = {
                        email: result.email,
                        loginTime: Date.now()
                    };
                    // Store it in the browser's local storage.
                    localStorage.setItem('invoice_pro_session', JSON.stringify(sessionToken));

                    // Redirect to the main app
                    window.location.href = '/'; 
                } else {
                     document.body.innerHTML = '<h1>Error: Access key is invalid or has already been used.</h1>';
                }
            } catch (error) {
                document.body.innerHTML = '<h1>An error occurred during validation. Please try again later.</h1>';
            }
        });
    </script>
</body>
</html>